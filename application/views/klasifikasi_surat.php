<!-- Main content -->
<div class="main-content" id="panel">
  <!-- Topnav -->
  <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <!-- Navbar links -->
        <ul class="navbar-nav align-items-center  ml-md-auto ">
          <li class="nav-item d-xl-none">
            <!-- Sidenav toggler -->
            <div class="pr-3 sidenav-toggler sidenav-toggler-dark" data-action="sidenav-pin" data-target="#sidenav-main">
              <div class="sidenav-toggler-inner">
                <i class="sidenav-toggler-line"></i>
                <i class="sidenav-toggler-line"></i>
                <i class="sidenav-toggler-line"></i>
              </div>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="ni ni-bell-55"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-xl  dropdown-menu-right  py-0 overflow-hidden">
              <!-- Dropdown header -->
              <div class="px-3 py-3">
                <h6 class="text-sm text-muted m-0">Anda memiliki <strong class="text-primary">13</strong> notifikasi.</h6>
              </div>
              <!-- List group -->
              <div class="list-group list-group-flush">
                <a href="#!" class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <!-- Avatar -->
                      <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-1.jpg" class="avatar rounded-circle">
                    </div>
                    <div class="col ml--2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h4 class="mb-0 text-sm">John Snow</h4>
                        </div>
                        <div class="text-right text-muted">
                          <small>31/12/2020</small>
                        </div>
                      </div>
                      <p class="text-sm mb-0">Surat Keterangan Beda Nama</p>
                    </div>
                  </div>
                </a>
                <a href="#!" class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <!-- Avatar -->
                      <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-2.jpg" class="avatar rounded-circle">
                    </div>
                    <div class="col ml--2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h4 class="mb-0 text-sm">Jessica</h4>
                        </div>
                        <div class="text-right text-muted">
                          <small>30/12/2020</small>
                        </div>
                      </div>
                      <p class="text-sm mb-0">Surat Keterangan Pengantar Nikah</p>
                    </div>
                  </div>
                </a>
                <a href="#!" class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <!-- Avatar -->
                      <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-3.jpg" class="avatar rounded-circle">
                    </div>
                    <div class="col ml--2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h4 class="mb-0 text-sm">Jane Snow</h4>
                        </div>
                        <div class="text-right text-muted">
                          <small>30/12/2020</small>
                        </div>
                      </div>
                      <p class="text-sm mb-0">Surat Keterangan Usaha</p>
                    </div>
                  </div>
                </a>
                <a href="#!" class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <!-- Avatar -->
                      <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-4.jpg" class="avatar rounded-circle">
                    </div>
                    <div class="col ml--2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h4 class="mb-0 text-sm">Jane Doe</h4>
                        </div>
                        <div class="text-right text-muted">
                          <small>29/12/2020</small>
                        </div>
                      </div>
                      <p class="text-sm mb-0">Surat Pengantar Akta Kelahiran</p>
                    </div>
                  </div>
                </a>
                <a href="#!" class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <!-- Avatar -->
                      <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-5.jpg" class="avatar rounded-circle">
                    </div>
                    <div class="col ml--2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h4 class="mb-0 text-sm">John Doe</h4>
                        </div>
                        <div class="text-right text-muted">
                          <small>28/12/2020</small>
                        </div>
                      </div>
                      <p class="text-sm mb-0">Surat Pengantar Akta Kematian</p>
                    </div>
                  </div>
                </a>
              </div>
              <!-- View all -->
              <a href="#!" class="dropdown-item text-center text-primary font-weight-bold py-3">Lihat semua</a>
            </div>
          </li>
        </ul>
        <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle">
                  <img alt="Image placeholder" src="<?php echo base_url(); ?>/assets/img/theme/team-4.jpg">
                </span>
                <div class="media-body  ml-2  d-none d-lg-block">
                  <span class="mb-0 text-sm  font-weight-bold">Sarmanta</span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu  dropdown-menu-right ">
              <a href="#!" class="dropdown-item">
                <i class="ni ni-single-02"></i>
                <span>Profil Saya</span>
              </a>
              <a href="#!" class="dropdown-item">
                <i class="fas fa-unlock-alt"></i>
                <span>Ubah Kata Sandi</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="#!" class="dropdown-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Keluar</span>
              </a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Header -->
  <!-- Header -->
  <div class="header bg-primary pb-6">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center py-4">
          <div class="col-lg-6 col-7">
            <h6 class="h2 text-white d-inline-block mb-0">Klasifikasi Surat</h6>
            <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
              <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
                <li class="breadcrumb-item"><a href="<?php echo base_url('beranda'); ?>">Beranda</a></li>
                <li class="breadcrumb-item active" aria-current="page">Klasifikasi Surat</li>
              </ol>
            </nav>
          </div>
          <div class="col-lg-6 col-5 text-right">
            <button type="button" class="btn btn-sm btn-neutral" data-toggle="modal" data-target="#modal-tambah">Tambah Klasifikasi Surat</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Page content -->
  <div class="container-fluid mt--6">
    <div class="row">
      <div class="col">
        <div class="card">
          <!-- Card header -->
          <div class="card-header">
            <h3 class="mb-0">Tabel Data Klasifikasi Surat</h3>
          </div>
          <!-- Light table -->
          <div class="table-responsive py-4">
            <table class="table table-flush" id="datatable-buttons">
              <thead class="thead-light">
                <tr>
                  <th style="width: 6%;">No</th>
                  <th style="width: 10%">Aksi</th>
                  <th style="width: 42%">Kode</th>
                  <th style="width: 42%">Tentang</th>
                </tr>
              </thead>
              <tfoot>
                <tr>
                  <th>No</th>
                  <th>Aksi</th>
                  <th>Kode</th>
                  <th>Tentang</th>
                </tr>
              </tfoot>
              <tbody>
                <?php foreach ($klasifikasi_surat as $data) : ?>
                  <tr>
                    <td><?php echo $no++; ?></td>
                    <td>
                      <button type="button" onclick="edit('<?php echo $data['id_klasifikasi_surat']; ?>')" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i></button>
                      <button type="button" onclick="hapus('<?php echo $data['id_klasifikasi_surat']; ?>', '<?php echo $data['tentang']; ?>')" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i></button>
                    </td>
                    <td><?php echo $data['kode']; ?></td>
                    <td><?php echo $data['tentang']; ?></td>
                  </tr>
                <?php endforeach; ?>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- modal tambah -->
<div class="modal fade" id="modal-tambah" tabindex="-1" role="dialog" aria-labelledby="modal-tambah" aria-hidden="true">
  <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="modal-title-default">Tambah Klasifikasi Surat</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form role="form" id="form-tambah" action="" method="POST">
        <div class="modal-body">
          <div class="form-group">
            <label for="kode" class="form-control-label">Kode</label>
            <input type="text" name="kode" id="kode" class="form-control" placeholder="Masukkan kode" required>
          </div>
          <div class="form-group">
            <label for="tentang" class="form-control-label">Tentang</label>
            <input type="text" name="tentang" id="tentang" class="form-control" placeholder="Masukkan tentang" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Simpan</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- modal edit -->
<div class="modal fade" id="modal-edit" tabindex="-1" role="dialog" aria-labelledby="modal-edit" aria-hidden="true">
  <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="modal-title-default">Ubah Klasifikasi Surat</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form role="form" id="form-edit" action="" method="POST">
        <input type="hidden" name="edit-id" id="edit-id">
        <div class="modal-body">
          <div class="form-group">
            <label for="edit-kode" class="form-control-label">Kode</label>
            <input type="text" name="edit-kode" id="edit-kode" class="form-control" placeholder="Masukkan kode" required>
          </div>
          <div class="form-group">
            <label for="edit-tentang" class="form-control-label">Tentang</label>
            <input type="text" name="edit-tentang" id="edit-tentang" class="form-control" placeholder="Masukkan tentang" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Ubah</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script type="text/javascript">
  function hapus(id, tentang) {
    let _id = id;
    Swal.fire({
      title: 'Hapus Klasifikasi Surat?',
      text: `${tentang}`,
      type: 'question',
      showCancelButton: true,
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      confirmButtonText: 'Ya, Hapus',
      cancelButtonColor: '#d33',
      cancelButtonText: 'Batal'
    }).then((result) => {
      if (result.value) {
        $.ajax({
          url: '<?= base_url('petugas/klasifikasi-surat/hapus-klasifikasi') ?>',
          method: "POST",
          data: {
            id: _id
          },
          dataType: "json",
          success: (response) => {
            if (response.status) {
              Swal.fire({
                type: 'success',
                title: `${response.title}`,
                text: `${response.text}`,
                button: {
                  text: "OK",
                  value: "OK"
                }
              }).then((value) => {
                location.reload();
              });
            } else {
              Swal.fire({
                type: 'error',
                title: `${response.title}.`,
                text: `${response.text}.`
              })
            }
          },
          error: (ee) => {
            console.log(` ee ${ee} `);
          }
        });
      }
    })
  }

  function edit(id) {
    $.ajax({
      url: '<?= base_url('petugas/klasifikasi-surat/detail-klasifikasi/') ?>' + id,
      type: "GET",
      dataType: "json",
      success: (response) => {
        $('[name="edit-id"]').val(response.id_klasifikasi_surat);
        $('[name="edit-kode"]').val(response.kode);
        $('[name="edit-tentang"]').val(response.tentang);
        $('#modal-edit').modal('show');
      },
      error: (err) => {
        Swal.fire({
          type: 'error',
          title: `Fetch Data : ${err}`
        })
      }
    });
  }

  $(() => {
    // submit form tambah
    $('#form-tambah').validate({
      errorElement: 'span',
      errorPlacement: (error, element) => {
        error.addClass('invalid-feedback');
        element.closest('.notif').append(error);
      },
      highlight: (element, errorClass, validClass) => {
        $(element).addClass('is-invalid');
      },
      unhighlight: (element, errorClass, validClass) => {
        $(element).removeClass('is-invalid');
      },
      submitHandler: () => {
        let form = $('#form-tambah')[0];
        let isi_form = new FormData(form);
        $.ajax({
          url: '<?= base_url('petugas/klasifikasi-surat/simpan-klasifikasi') ?>',
          method: "POST",
          data: isi_form,
          dataType: "json",
          cache: false,
          contentType: false,
          processData: false,
          success: (response) => {
            $('#modal-tambah').modal('hide');
            if (response.status) {
              Swal.fire({
                type: 'success',
                title: `${response.title}`,
                text: `${response.text}`,
                button: {
                  text: "OK",
                  value: "OK"
                }
              }).then((value) => {
                location.reload();
              });
            } else {
              $('#modal-tambah').modal('hide');
              Swal.fire({
                type: 'error',
                title: `${response.title}`,
                text: `${response.text}`,
              })
            }
          },
          error: (err) => {
            Swal.fire({
              type: 'error',
              title: `Error Submit Data: ${err}.`
            })
          }
        });
      }
    });

    // submit form edit
    $('#form-edit').validate({
      errorElement: 'span',
      errorPlacement: (error, element) => {
        error.addClass('invalid-feedback');
        element.closest('.notif').append(error);
      },
      highlight: (element, errorClass, validClass) => {
        $(element).addClass('is-invalid');
      },
      unhighlight: (element, errorClass, validClass) => {
        $(element).removeClass('is-invalid');
      },
      submitHandler: () => {
        let form = $('#form-edit')[0];
        let isi_form = new FormData(form);
        $.ajax({
          url: '<?= base_url('petugas/klasifikasi-surat/edit-klasifikasi') ?>',
          method: "POST",
          data: isi_form,
          dataType: "json",
          cache: false,
          contentType: false,
          processData: false,
          success: (response) => {
            if (response.status) {
              $('#modal-edit').modal('hide');
              Swal.fire({
                type: 'success',
                title: `${response.title}`,
                text: `${response.text}`,
                button: {
                  text: "OK",
                  value: "OK"
                }
              }).then((value) => {
                location.reload();
              });
            } else {
              $('#modal-edit').modal('hide');
              Swal.fire({
                type: 'error',
                title: `${response.title}`,
                text: `${response.text}.`
              })
            }
          },
          error: (err) => {
            Swal.fire({
              type: 'error',
              title: `Error Submit Proses: ${err}.`
            })
          }
        });
      }
    });
  });
</script>